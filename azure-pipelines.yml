resources:
  repositories:
  - repository: self
    type: git
    ref: Development
jobs:
- job: Job_1
  displayName: Agent job 1
  pool:
    vmImage: ubuntu-20.04
  steps:
  - checkout: self
  - task: DockerCompose@0
    displayName: Build services
    inputs:
      containerregistrytype: 'Azure Container Registry'
      azureSubscription: 'Azure subscription 1 (7d136500-033c-49d1-85f8-efa4bab3e586)'
      azureContainerRegistry: '{"loginServer":"itechlib.azurecr.io", "id" : "/subscriptions/7d136500-033c-49d1-85f8-efa4bab3e586/resourceGroups/itechlib/providers/Microsoft.ContainerRegistry/registries/itechlib"}'
      dockerComposeFile: docker-compose.yaml
      action: 'Build services'
 # - task: DockerCompose@0
 #   displayName: Push services
  #  inputs:
  #    containerregistrytype: 'Azure Container Registry'
  #    azureSubscription: 'Azure subscription 1 (7d136500-033c-49d1-85f8-efa4bab3e586)'
  #    azureContainerRegistry: '{"loginServer":"itechlib.azurecr.io", "id" : "/subscriptions/7d136500-033c-49d1-85f8-efa4bab3e586/resourceGroups/itechlib/providers/Microsoft.ContainerRegistry/registries/itechlib"}'
  #    dockerComposeFile: docker-compose.yaml
  #    action: 'Push services'
  - task: AzureRmWebAppDeployment@4
    displayName: 'Azure App Service Deploy: itechlib'
    inputs:
      ConnectionType: 'AzureRM'
      azureSubscription: 'Azure subscription 1 (7d136500-033c-49d1-85f8-efa4bab3e586)'
      appType: 'webAppContainer'
      WebAppName: 'itechlib'
      DockerNamespace: 'itechlib.azurecr.io'
      DockerImageTag: 'latest'
   